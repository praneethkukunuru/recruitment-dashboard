<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Recruitment Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://accounts.google.com/gsi/client"></script>
    <style>
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }
        
        .login-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .login-subtitle {
            color: #666;
            margin-bottom: 2rem;
        }
        
        .google-signin-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .google-signin-container iframe {
            border-radius: 6px !important;
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 6px;
            margin-top: 1rem;
            display: none;
        }
        
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-logo">TG</div>
            <h1 class="login-title">Recruitment Dashboard</h1>
            <p class="login-subtitle">Sign in to access your analytics</p>
            
            <div id="google-signin-btn" class="google-signin-container"></div>
            
            <div id="error-message" class="error-message"></div>
        </div>
    </div>

    <script>
        // Global function that Google OAuth can call
        function handleCredentialResponse(response) {
            const errorMessage = document.getElementById('error-message');
            
            // Send the credential to the backend
            fetch('/auth/google', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    token: response.credential
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Redirect to dashboard
                    window.location.href = '/';
                } else {
                    showError(data.error || 'Authentication failed');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showError('Network error. Please try again.');
            });
        }
        
        function showError(message) {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function initializeGoogleSignIn() {
            // Check if Google script is loaded
            if (typeof google === 'undefined' || !google.accounts) {
                console.log('Google script not loaded yet, retrying...');
                setTimeout(initializeGoogleSignIn, 100);
                return;
            }

            // Get Google Client ID from backend first
            fetch('/auth/config')
            .then(response => response.json())
            .then(data => {
                if (data.client_id) {
                    // Initialize Google Sign-In with actual client ID
                    google.accounts.id.initialize({
                        client_id: data.client_id,
                        callback: handleCredentialResponse,
                        auto_select: false,
                        cancel_on_tap_outside: true
                    });
                    
                    // Render the Google Sign-In button
                    google.accounts.id.renderButton(
                        document.getElementById('google-signin-btn'),
                        {
                            theme: 'outline',
                            size: 'large',
                            width: '100%',
                            text: 'signin_with',
                            shape: 'rectangular'
                        }
                    );
                } else {
                    showError('Google Client ID not configured');
                }
            })
            .catch(error => {
                console.error('Error getting Google Client ID:', error);
                showError('Failed to load authentication configuration');
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Start initialization process
            initializeGoogleSignIn();
        });
    </script>
</body>
</html>
